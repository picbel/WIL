// Metadata:
:description: Week I Learnt
:keywords: study, til, lwil
// Settings:
:doctype: book
:toc: left
:toclevels: 4
:sectlinks:
:icons: font
:hardbreaks:


[[section-202503]]
== 2025년 3월

[[section-202503-5일]]
5일
===
### API Rate Limiting
API Rate Limiting은 클라이언트가 일정 시간 동안 너무 많은 요청을 보내는 것을 방지하기 위해 사용된다.

대표적인 알고리즘으로는 아래 두개가 있다
- 토큰 버킷 알고리즘 : 버킷에 토큰을 일정 간격으로 채워두고, 요청 시 토큰을 소비하는 방식이다. 토큰이 있을 때만 요청이 처리됨, 일정 수준의 버스트 트래픽도 허용할 수 있다.
- 리퀘스트 카운터 : 고정된 시간 창(예: 1분)에 요청 횟수를 카운트하여 제한을 넘기면 요청을 차단한다. 구현이 간단, 경계 구간에서 트래픽이 몰릴 수 있는 단점이 있다.

#### Spring Cloud Gateway를 이용한 Rate Limiting
Spring Cloud Gateway에서 Redis를 활용한 Rate Limiting은 토큰 버킷(Token Bucket) 알고리즘을 기반으로 동작한다. 
분산 환경에서도 안정적으로 요청 제한을 적용할 수 있어 실무에서도 자주 사용된다.

1. 토큰 버킷 방식 기반
요청이 들어올 때마다 Redis에서 토큰을 하나씩 소모하는 구조다.
replenishRate를 설정하면 초당 일정 개수의 토큰이 추가되며,
burstCapacity를 통해 순간적으로 몰리는 요청도 처리할 수 있다.

2. 분산 서버 환경에서 안정적으로 동작
여러 Gateway 인스턴스가 동일한 Redis를 바라보도록 구성하면, 전역적으로 일관된 Rate Limiting이 가능하다.
Redis 내에서는 Lua 스크립트를 사용해 토큰 생성과 소비가 원자적으로 처리되므로, 서버 간 중복 처리 문제도 방지된다.

3. 유연한 API별 / 유저별 Rate Limiting 설정
API 경로마다 서로 다른 replenishRate와 burstCapacity 값을 설정할 수 있다.
KeyResolver를 활용하면 유저 ID, IP 등 기준에 따라 개별 Rate Limiting 적용도 가능하다.
일부 API에는 제한을 걸고, 나머지는 무제한 허용하는 설정도 유연하게 할 수 있다.

4. 실시간 설정 변경 가능
Rate Limiting 설정을 Redis에 저장해두면, 운영 중에도 설정값을 실시간으로 조정할 수 있다.
예를 들어 /api/limited의 요청 속도를 조절하려면, Redis의 설정값만 변경하면 즉시 적용된다.

---
[[section-202503-10일]]
10일
===
### Record Lock

---

[[section-202503-17일]]
17일
===
### MySQL의 데드락(Deadlock) 처리

---

[[section-202503-19일]]
19일
===
### 디바운싱과 쓰로틀링

---
[[section-202503-23일]]
23일
===
Redisson 문서에서도 Pub/Sub Lock 이 CPU 폭증과 트래픽 유발 문제가 있음을 고지


---
mysql의 Gap Lock
